<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Générateur de prompts basé sur la méthode CADREZ.">
    <title>CADREZ - Le Plan Promptable</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Google Sans Flex"', '"Outfit"', 'sans-serif'],
                        mono: ['"Roboto Mono"', 'monospace'],
                    },
                    colors: {
                        md: {
                            sys: {
                                primary: '#0b57d0',
                                surface: '#f0f4f9',
                                on_surface: '#1f1f1f',
                                outline: '#747775',
                            }
                        },
                        cadrez: {
                            c: '#ea8e24', /* Orange Collaborateur */
                            a: '#f7b42c', /* Jaune Action */
                            d: '#4caf50', /* Vert Description */
                            r: '#29b6f6', /* Bleu Ressources */
                            e: '#1e88e5', /* Bleu foncé Exigences */
                            z: '#9c27b0', /* Violet Zéro oubli */
                        }
                    }
                }
            }
        }
    </script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans+Flex:opsz,wght@8..144,100..1000&family=Outfit:wght@300;400;500;600&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Google Sans Flex', 'Outfit', sans-serif; background-color: #f0f4f9; overscroll-behavior-y: none; }
        
        /* Material Inputs */
        .m3-field { position: relative; background-color: #f0f4f9; border-radius: 8px 8px 0 0; border-bottom: 1px solid #747775; transition: all 0.2s; }
        .m3-field:focus-within { background-color: #e8edfa; border-bottom: 2px solid #0b57d0; }
        .m3-input { width: 100%; background: transparent; border: none; padding: 24px 16px 8px 16px; outline: none; font-size: 1rem; color: #1f1f1f; line-height: 1.5; font-family: inherit; }
        .m3-input:not(:focus)::placeholder { opacity: 0; }
        .m3-label { position: absolute; left: 16px; top: 18px; font-size: 1rem; color: #444746; pointer-events: none; transition: 0.2s ease all; max-width: 90%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .m3-input:focus ~ .m3-label, .m3-input:not(:placeholder-shown) ~ .m3-label { top: 6px; font-size: 0.75rem; color: #0b57d0; font-weight: 500; }
        
        /* Select Chevron Fix */
        select.m3-input { appearance: none; cursor: pointer; }
        .m3-select-wrapper { position: relative; }
        .m3-select-wrapper::after { content: '\f078'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; right: 16px; top: 50%; transform: translateY(-25%); font-size: 0.75rem; color: #444746; pointer-events: none; }

        /* Checkbox */
        .m3-checkbox-container { display: flex; align-items: center; cursor: pointer; padding: 8px 0; }
        .m3-checkbox { appearance: none; background-color: #fff; width: 1.25em; height: 1.25em; border: 2px solid #747775; border-radius: 2px; display: grid; place-content: center; margin-right: 12px; transition: 0.2s all; }
        .m3-checkbox::before { content: ""; width: 0.75em; height: 0.75em; transform: scale(0); transition: 120ms transform ease-in-out; box-shadow: inset 1em 1em white; clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%); }
        .m3-checkbox:checked { background-color: #9c27b0; border-color: #9c27b0; }
        .m3-checkbox:checked::before { transform: scale(1); }

        /* CADREZ Colors */
        .c-text { color: #ea8e24; } .c-bg { background-color: #ea8e24; }
        .a-text { color: #f7b42c; } .a-bg { background-color: #f7b42c; }
        .d-text { color: #4caf50; } .d-bg { background-color: #4caf50; }
        .r-text { color: #29b6f6; } .r-bg { background-color: #29b6f6; }
        .e-text { color: #1e88e5; } .e-bg { background-color: #1e88e5; }
        .z-text { color: #9c27b0; } .z-bg { background-color: #9c27b0; }

        .cadrez-letter { font-weight: 900; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 6px; color: white; margin-right: 12px; font-size: 0.9rem; flex-shrink: 0; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #c4c7c5; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #747775; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>

<body class="h-dvh w-screen overflow-hidden flex flex-col md:flex-row text-[#1f1f1f]">

    <!-- EDITOR PANEL (Left) -->
    <aside id="panel-editor" class="w-full md:w-[500px] flex-col h-full bg-white border-r border-[#c4c7c5] z-20 shadow-lg flex">
        <header class="p-4 flex items-center justify-between border-b border-gray-100 flex-none bg-white">
            <div class="flex items-center gap-2">
                <div class="flex gap-0.5">
                    <div class="w-3 h-3 rounded-sm c-bg"></div>
                    <div class="w-3 h-3 rounded-sm a-bg"></div>
                    <div class="w-3 h-3 rounded-sm d-bg"></div>
                    <div class="w-3 h-3 rounded-sm r-bg"></div>
                    <div class="w-3 h-3 rounded-sm e-bg"></div>
                    <div class="w-3 h-3 rounded-sm z-bg"></div>
                </div>
                <h1 class="text-xl font-normal tracking-tight text-[#444746]">Plan<span class="font-medium text-black">Promptable</span></h1>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="toggleLanguage()" class="text-xs font-medium text-md-sys-primary hover:bg-blue-50 px-3 py-1.5 rounded-full transition border border-blue-100 uppercase">
                    <span id="lang-display">FR</span>
                </button>
                <button onclick="resetForm()" class="text-gray-400 hover:text-red-500 hover:bg-red-50 p-2 rounded-full transition" title="Tout effacer">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </header>

        <div class="flex-grow overflow-y-auto p-5 space-y-8 pb-4">
            
            <!-- C - Collaborateur -->
            <div class="space-y-3 relative">
                <div class="flex items-center sticky top-0 bg-white/95 backdrop-blur z-10 py-2 border-b border-dashed border-gray-200">
                    <span class="cadrez-letter c-bg">C</span>
                    <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider" id="txt-c-title">Collaborateur</h3>
                    <span class="text-[10px] text-gray-400 ml-auto font-mono uppercase" id="txt-c-sub">Tu es...</span>
                </div>
                
                <div class="m3-field m3-select-wrapper rounded-t-lg">
                    <select id="role-select" class="m3-input pt-6 bg-transparent" onchange="syncRole()"></select>
                    <label class="m3-label" id="lbl-c-select">Expertise (Suggestion)</label>
                </div>
                <div class="m3-field">
                    <input type="text" id="role-custom" class="m3-input" placeholder=" " oninput="updateOutput()">
                    <label class="m3-label" id="lbl-c-custom">Rôle personnalisé</label>
                </div>
            </div>

            <!-- A - Action -->
            <div class="space-y-3 relative">
                <div class="flex items-center sticky top-0 bg-white/95 backdrop-blur z-10 py-2 border-b border-dashed border-gray-200">
                    <span class="cadrez-letter a-bg">A</span>
                    <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider" id="txt-a-title">Action</h3>
                    <span class="text-[10px] text-gray-400 ml-auto font-mono uppercase" id="txt-a-sub">Ta mission est de...</span>
                </div>

                <div class="m3-field m3-select-wrapper rounded-t-lg">
                    <select id="action-select" class="m3-input pt-6 bg-transparent" onchange="syncAction()"></select>
                    <label class="m3-label" id="lbl-a-select">Verbe d'action (Suggestion)</label>
                </div>
                <div class="m3-field">
                    <textarea id="task" rows="2" class="m3-input resize-none" placeholder=" " oninput="updateOutput()"></textarea>
                    <label class="m3-label" id="lbl-a-custom">Détail de la mission</label>
                </div>
            </div>

            <!-- D - Description -->
            <div class="space-y-3 relative">
                <div class="flex items-center sticky top-0 bg-white/95 backdrop-blur z-10 py-2 border-b border-dashed border-gray-200">
                    <span class="cadrez-letter d-bg">D</span>
                    <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider" id="txt-d-title">Description</h3>
                    <span class="text-[10px] text-gray-400 ml-auto font-mono uppercase" id="txt-d-sub">Le contexte est...</span>
                </div>
                
                <div class="m3-field">
                    <textarea id="context" rows="4" class="m3-input resize-none" placeholder=" " oninput="updateOutput()"></textarea>
                    <label class="m3-label" id="lbl-d-context">Cible, Contexte technique, Business, Contraintes...</label>
                </div>
                <div class="flex gap-2 overflow-x-auto pb-1 no-scrollbar">
                    <button onclick="appendContext('Cible : ')" class="text-xs border border-gray-200 rounded-full px-3 py-1 hover:bg-gray-50 text-gray-500 whitespace-nowrap" id="btn-tag-target">+ Cible</button>
                    <button onclick="appendContext('Tech : ')" class="text-xs border border-gray-200 rounded-full px-3 py-1 hover:bg-gray-50 text-gray-500 whitespace-nowrap" id="btn-tag-tech">+ Technique</button>
                    <button onclick="appendContext('Business : ')" class="text-xs border border-gray-200 rounded-full px-3 py-1 hover:bg-gray-50 text-gray-500 whitespace-nowrap" id="btn-tag-biz">+ Business</button>
                </div>
            </div>

            <!-- R - Ressources -->
            <div class="space-y-3 relative">
                <div class="flex items-center sticky top-0 bg-white/95 backdrop-blur z-10 py-2 border-b border-dashed border-gray-200">
                    <span class="cadrez-letter r-bg">R</span>
                    <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider" id="txt-r-title">Ressources</h3>
                    <span class="text-[10px] text-gray-400 ml-auto font-mono uppercase" id="txt-r-sub">Tu t'appuieras sur...</span>
                </div>

                <div class="m3-field m3-select-wrapper rounded-t-lg">
                    <select id="method-select" class="m3-input pt-6 bg-transparent" onchange="updateOutput()"></select>
                    <label class="m3-label" id="lbl-r-method">Cadre / Méthode (Optionnel)</label>
                </div>
                <div class="m3-field">
                    <textarea id="resources" rows="2" class="m3-input resize-none" placeholder=" " oninput="updateOutput()"></textarea>
                    <label class="m3-label" id="lbl-r-custom">Données, fichiers, texte brut...</label>
                </div>
            </div>

            <!-- E - Exigences -->
            <div class="space-y-3 relative">
                <div class="flex items-center sticky top-0 bg-white/95 backdrop-blur z-10 py-2 border-b border-dashed border-gray-200">
                    <span class="cadrez-letter e-bg">E</span>
                    <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider" id="txt-e-title">Exigences</h3>
                    <span class="text-[10px] text-gray-400 ml-auto font-mono uppercase" id="txt-e-sub">Le résultat doit...</span>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="m3-field m3-select-wrapper">
                        <select id="tone" class="m3-input pt-6 bg-transparent" onchange="updateOutput()"></select>
                        <label class="m3-label" id="lbl-e-tone">Ton & Style</label>
                    </div>
                    <div class="m3-field m3-select-wrapper">
                        <select id="format" class="m3-input pt-6 bg-transparent" onchange="updateOutput()"></select>
                        <label class="m3-label" id="lbl-e-format">Format Livrable</label>
                    </div>
                </div>
                <div class="m3-field">
                    <input type="text" id="constraints" class="m3-input" placeholder=" " oninput="updateOutput()">
                    <label class="m3-label" id="lbl-e-const">Contraintes négatives (Pas de...)</label>
                </div>
            </div>

            <!-- Z - Zéro oubli -->
            <div class="space-y-3 pt-4 border-t-4 border-[#f0f4f9]">
                <div class="flex items-center">
                    <span class="cadrez-letter z-bg">Z</span>
                    <h3 class="text-sm font-bold text-gray-700 uppercase tracking-wider" id="txt-z-title">Zéro oubli</h3>
                </div>
                <label class="m3-checkbox-container p-3 rounded-lg hover:bg-purple-50 transition-colors border border-transparent hover:border-purple-100">
                    <input type="checkbox" id="zero-forget" class="m3-checkbox" onchange="updateOutput()" checked>
                    <div class="flex flex-col">
                        <span class="text-sm text-[#1f1f1f] font-medium" id="lbl-z-check">Activer la sécurisation</span>
                        <span class="text-xs text-gray-500 italic mt-0.5" id="lbl-z-sub">"Avant de commencer, pose-moi toutes les questions..."</span>
                    </div>
                </label>
            </div>
            
            <!-- Mobile Footer (Visible only on mobile inside scroll) -->
            <div class="md:hidden pt-8 pb-4 text-center border-t border-gray-100 mt-4">
                <p class="text-xs text-gray-500 mb-2"><span id="lbl-developed-mobile">Développé par</span> <strong class="text-gray-700">Fabrice Faucheux</strong></p>
                <a href="https://paypal.me/FFaucheux?country.x=FR&locale.x=fr_FR" target="_blank" class="text-xs inline-flex items-center gap-2 px-4 py-2 bg-[#003087] text-white rounded-full hover:bg-[#001c64] transition shadow-sm font-medium">
                    <i class="fab fa-paypal"></i> <span id="lbl-tip-mobile">M'offrir un pourboire</span>
                </a>
            </div>
            
            <div class="h-6"></div> 
        </div>

        <!-- FOOTER (Desktop Only) -->
        <footer class="hidden md:block flex-none p-4 border-t border-gray-200 bg-gray-50 text-center">
             <p class="text-xs text-gray-500 mb-2"><span id="lbl-developed">Développé par</span> <strong class="text-gray-700">Fabrice Faucheux</strong></p>
             <a href="https://paypal.me/FFaucheux?country.x=FR&locale.x=fr_FR" target="_blank" class="text-xs inline-flex items-center gap-2 px-4 py-2 bg-[#003087] text-white rounded-full hover:bg-[#001c64] transition shadow-sm font-medium">
                <i class="fab fa-paypal"></i> <span id="lbl-tip">M'offrir un pourboire</span>
            </a>
        </footer>
    </aside>

    <!-- PREVIEW PANEL (Right) -->
    <main id="panel-preview" class="hidden md:flex flex-grow flex-col h-full bg-md-sys-surface overflow-hidden relative">
        <div class="flex-none px-6 pt-6 pb-3 flex justify-between items-end">
            <!-- Simplified Header (No Tabs) -->
            <div class="flex bg-white rounded-full p-1 shadow-sm border border-gray-200">
                <div class="px-5 py-2 rounded-full text-sm flex items-center gap-2 bg-[#d3e3fd] text-[#041e49] font-semibold select-none">
                    <i class="fas fa-sparkles text-lg"></i> <span id="lbl-preview">Aperçu</span>
                </div>
            </div>
            
            <div class="flex gap-2">
                 <button onclick="copyContent()" class="bg-[#1f1f1f] hover:bg-black text-white pl-4 pr-5 py-2.5 rounded-full shadow-lg hover:shadow-xl transition-all flex items-center gap-2 text-sm font-medium group">
                    <i class="far fa-copy group-hover:scale-110 transition-transform"></i> <span id="btn-copy-txt">Copier</span>
                </button>
            </div>
        </div>

        <div class="flex-grow px-6 pb-6 overflow-hidden">
            <div class="h-full w-full bg-white rounded-[24px] border border-white shadow-sm overflow-hidden flex flex-col relative">
                <!-- Decoration line -->
                <div class="h-1.5 w-full flex">
                    <div class="flex-1 c-bg"></div>
                    <div class="flex-1 a-bg"></div>
                    <div class="flex-1 d-bg"></div>
                    <div class="flex-1 r-bg"></div>
                    <div class="flex-1 e-bg"></div>
                    <div class="flex-1 z-bg"></div>
                </div>

                <div id="view-markdown" class="p-8 overflow-y-auto h-full prose prose-slate max-w-none font-sans text-gray-700">
                    <div id="markdown-content" class="whitespace-pre-wrap leading-relaxed text-lg"></div>
                    <div id="empty-state" class="flex flex-col items-center justify-center h-full text-center opacity-40 select-none pb-20">
                        <i class="fas fa-magic text-6xl mb-4 text-gray-300"></i>
                        <p class="text-xl font-medium text-gray-400" id="txt-empty-state">Remplissez le formulaire<br>pour générer votre prompt</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- MOBILE NAV -->
    <nav class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 flex justify-around p-2 z-50 pb-safe">
        <button onclick="showMobileTab('editor')" id="nav-btn-editor" class="active flex flex-col items-center p-2 flex-1 text-md-sys-primary">
            <i class="fas fa-sliders-h mb-1"></i><span class="text-[10px] font-medium" id="lbl-nav-edit">Éditer</span>
        </button>
        <button onclick="showMobileTab('preview')" id="nav-btn-preview" class="flex flex-col items-center p-2 flex-1 text-gray-400">
            <i class="fas fa-eye mb-1"></i><span class="text-[10px] font-medium" id="lbl-nav-view">Résultat</span>
        </button>
    </nav>

    <!-- MOBILE PREVIEW OVERLAY -->
    <div id="mobile-preview-overlay" class="fixed inset-0 bg-gray-50 z-40 hidden flex-col md:hidden">
        <div class="p-4 bg-white border-b flex justify-between items-center shadow-sm">
            <h2 class="font-bold text-gray-700" id="lbl-mob-title">Votre Prompt</h2>
            <button onclick="copyContent()" class="text-sm bg-black text-white px-4 py-2 rounded-full font-medium" id="btn-mob-copy">Copier</button>
        </div>
        <div class="p-4 overflow-y-auto flex-grow prose">
            <div id="mobile-markdown-content" class="whitespace-pre-wrap text-sm"></div>
        </div>
        <div class="h-16"></div> <!-- Spacer for nav -->
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed top-6 left-1/2 transform -translate-x-1/2 bg-[#323232] text-white px-5 py-3 rounded-full shadow-2xl opacity-0 transition-opacity duration-300 z-[60] flex items-center gap-3 scale-90 pointer-events-none">
        <i class="fas fa-check-circle text-green-400"></i><span class="font-medium" id="txt-toast">Prompt copié !</span>
    </div>

    <script>
        // --- TRANSLATION & DATA ---
        const uiTranslations = {
            fr: {
                "txt-c-title": "Collaborateur", "txt-c-sub": "Tu es...", "lbl-c-select": "Expertise (Suggestion)", "lbl-c-custom": "Rôle personnalisé",
                "txt-a-title": "Action", "txt-a-sub": "Ta mission est de...", "lbl-a-select": "Verbe d'action (Suggestion)", "lbl-a-custom": "Détail de la mission",
                "txt-d-title": "Description", "txt-d-sub": "Le contexte est...", "lbl-d-context": "Cible, Contexte technique, Business, Contraintes...",
                "txt-r-title": "Ressources", "txt-r-sub": "Tu t'appuieras sur...", "lbl-r-method": "Cadre / Méthode (Optionnel)", "lbl-r-custom": "Données, fichiers, texte brut...",
                "txt-e-title": "Exigences", "txt-e-sub": "Le résultat doit...", "lbl-e-tone": "Ton & Style", "lbl-e-format": "Format Livrable", "lbl-e-const": "Contraintes négatives (Pas de...)",
                "txt-z-title": "Zéro oubli", "lbl-z-check": "Activer la sécurisation", "lbl-z-sub": "\"Avant de commencer, pose-moi toutes les questions...\"",
                "lbl-preview": "Aperçu", "btn-copy-txt": "Copier", "txt-empty-state": "Remplissez le formulaire<br>pour générer votre prompt",
                "lbl-developed": "Développé par", "lbl-tip": "M'offrir un pourboire",
                "lbl-developed-mobile": "Développé par", "lbl-tip-mobile": "M'offrir un pourboire",
                "lbl-nav-edit": "Éditer", "lbl-nav-view": "Résultat", "lbl-mob-title": "Votre Prompt", "btn-mob-copy": "Copier", "txt-toast": "Prompt copié !",
                "btn-tag-target": "+ Cible", "btn-tag-tech": "+ Technique", "btn-tag-biz": "+ Business"
            },
            en: {
                "txt-c-title": "Collaborator", "txt-c-sub": "You are...", "lbl-c-select": "Expertise (Suggestion)", "lbl-c-custom": "Custom Role",
                "txt-a-title": "Action", "txt-a-sub": "Your mission is to...", "lbl-a-select": "Action Verb (Suggestion)", "lbl-a-custom": "Mission Details",
                "txt-d-title": "Description", "txt-d-sub": "The context is...", "lbl-d-context": "Target audience, Tech context, Business, Constraints...",
                "txt-r-title": "Resources", "txt-r-sub": "You will rely on...", "lbl-r-method": "Framework / Method (Optional)", "lbl-r-custom": "Data, files, raw text...",
                "txt-e-title": "Requirements", "txt-e-sub": "The result must...", "lbl-e-tone": "Tone & Style", "lbl-e-format": "Deliverable Format", "lbl-e-const": "Negative constraints (No...)",
                "txt-z-title": "Zero Oversight", "lbl-z-check": "Enable Quality Check", "lbl-z-sub": "\"Before starting, ask me all questions...\"",
                "lbl-preview": "Preview", "btn-copy-txt": "Copy", "txt-empty-state": "Fill out the form<br>to generate your prompt",
                "lbl-developed": "Developed by", "lbl-tip": "Leave a tip",
                "lbl-developed-mobile": "Developed by", "lbl-tip-mobile": "Leave a tip",
                "lbl-nav-edit": "Edit", "lbl-nav-view": "Result", "lbl-mob-title": "Your Prompt", "btn-mob-copy": "Copy", "txt-toast": "Prompt Copied!",
                "btn-tag-target": "+ Target", "btn-tag-tech": "+ Tech", "btn-tag-biz": "+ Business"
            }
        };

        const data = {
            fr: {
                roles: {
                    "Analyse & Gestion": ["Acheteur", "Auditeur financier", "Contrôleur de gestion", "Data analyst", "Expert cybersécurité", "Juriste"],
                    "Formation & RH": ["Concepteur e-learning", "Formateur", "Ingénieur pédagogique", "Recruteur", "Responsable RH", "Talent manager", "Vulgarisateur"],
                    "Création & Rédaction": ["Community manager", "Copywriter", "Ghostwriter", "Journaliste", "Rédacteur technique", "Scénariste", "Storyteller", "UX Writer"],
                    "Technique & Métier": ["Architecte logiciel", "Chef de projet", "Data scientist", "Développeur"],
                    "Stratégie & Conseil": ["Analyste marché", "Business developer", "Chef de produit", "Coach agile", "Consultant senior", "Key account manager"]
                },
                actions: {
                    "Exploration": ["Cartographier", "Collecter", "Énoncer", "Explorer", "Imaginer", "Investiguer", "Rechercher", "Lister", "Tester"],
                    "Production": ["Adapter", "Construire", "Créer", "Développer", "Générer (idées, quiz)", "Personnaliser", "Rédiger", "Reformuler", "Traduire"],
                    "Analyse": ["Auditer", "Comparer", "Diagnostiquer", "Évaluer", "Extraire", "Identifier", "Synthétiser"],
                    "Stratégie": ["Négocier", "Optimiser", "Orchestrer", "Organiser", "Planifier", "Prioriser", "Simuler", "Structurer"]
                },
                methods: {
                    "Gestion & Analyse": ["ABC (Gestion)", "PESTEL (Analyse)", "SWOT (Stratégie)", "Six Sigma (Qualité)"],
                    "Marketing & Vente": ["AIDA (Marketing)", "Persona (Cible)"],
                    "Pédagogie & RH": ["ADDIE (Ingénierie)", "Bloom (Objectifs)", "Kirkpatrick (Évaluation)", "STAR (Entretien)"],
                    "Créativité": ["SCAMPER (Idéation)", "6 Chapeaux de Bono"]
                },
                tones: ["Défaut", "Académique", "Empathique", "Expert", "Factuel", "Institutionnel", "Journalistique", "Pédagogique", "Persuasif", "Professionnel", "Technique", "Vivant"],
                formats: ["Texte libre", "Checklist", "Compte-rendu", "Email", "Étude de cas", "FAQ / Q&A", "Liste à puces", "Post LinkedIn", "Script (vidéo/podcast)", "Synthèse exécutive", "Tableau"],
                magic_phrase: "Avant de commencer, pose-moi toutes les questions que tu as à ce sujet. Sois exhaustif."
            },
            en: {
                roles: {
                    "Analysis & Management": ["Buyer", "Financial Auditor", "Management Controller", "Data Analyst", "Cybersecurity Expert", "Legal Counsel"],
                    "Training & HR": ["E-learning Designer", "Trainer", "Instructional Designer", "Recruiter", "HR Manager", "Talent Manager", "Science Communicator"],
                    "Creation & Writing": ["Community Manager", "Copywriter", "Ghostwriter", "Journalist", "Technical Writer", "Screenwriter", "Storyteller", "UX Writer"],
                    "Tech & Product": ["Software Architect", "Project Manager", "Data Scientist", "Developer"],
                    "Strategy & Consulting": ["Market Analyst", "Business Developer", "Product Manager", "Agile Coach", "Senior Consultant", "Key Account Manager"]
                },
                actions: {
                    "Exploration": ["Map", "Collect", "State", "Explore", "Imagine", "Investigate", "Research", "List", "Test"],
                    "Production": ["Adapt", "Build", "Create", "Develop", "Generate (ideas, quiz)", "Personalize", "Draft", "Reformulate", "Translate"],
                    "Analysis": ["Audit", "Compare", "Diagnose", "Evaluate", "Extract", "Identify", "Synthesize"],
                    "Strategy": ["Negotiate", "Optimize", "Orchestrate", "Organize", "Plan", "Prioritize", "Simulate", "Structure"]
                },
                methods: {
                    "Management & Analysis": ["ABC (Management)", "PESTEL (Analysis)", "SWOT (Strategy)", "Six Sigma (Quality)"],
                    "Marketing & Sales": ["AIDA (Marketing)", "Persona (Target)"],
                    "Pedagogy & HR": ["ADDIE (Instruction)", "Bloom (Objectives)", "Kirkpatrick (Evaluation)", "STAR (Interview)"],
                    "Creativity": ["SCAMPER (Ideation)", "6 Thinking Hats"]
                },
                tones: ["Default", "Academic", "Empathetic", "Expert", "Factual", "Institutional", "Journalistic", "Educational", "Persuasive", "Professional", "Technical", "Lively"],
                formats: ["Free text", "Checklist", "Minutes", "Email", "Case Study", "FAQ / Q&A", "Bullet Points", "LinkedIn Post", "Script (video/podcast)", "Executive Summary", "Table"],
                magic_phrase: "Before starting, ask me all the questions you have about this. Be exhaustive."
            }
        };

        let state = { lang: 'fr' };

        function init() {
            renderSelects();
            applyTranslations();
            updateOutput();
        }

        function toggleLanguage() {
            state.lang = state.lang === 'fr' ? 'en' : 'fr';
            document.getElementById('lang-display').innerText = state.lang.toUpperCase();
            renderSelects();
            applyTranslations();
            updateOutput();
        }

        function applyTranslations() {
            const t = uiTranslations[state.lang];
            for (const [id, text] of Object.entries(t)) {
                const el = document.getElementById(id);
                // Utilisation de innerHTML au lieu de innerText pour interpréter les balises <br>
                if (el) el.innerHTML = text;
            }
        }

        function renderSelects() {
            const d = data[state.lang];
            
            // Helper for grouped selects
            const fillGrouped = (id, dataObj) => {
                const el = document.getElementById(id);
                const currentVal = el.value; // Try to preserve selection if possible (mostly for simple switches)
                let html = `<option value="">- ${state.lang === 'fr' ? 'Sélectionner' : 'Select'} -</option>`;
                
                for (const [group, items] of Object.entries(dataObj)) {
                    html += `<optgroup label="${group}">`;
                    items.forEach(item => {
                        html += `<option value="${item}">${item}</option>`;
                    });
                    html += `</optgroup>`;
                }
                el.innerHTML = html;
            };

            // Helper for simple selects
            const fillSimple = (id, list) => {
                const el = document.getElementById(id);
                const currentVal = el.value;
                el.innerHTML = [`<option value="">- ${state.lang === 'fr' ? 'Sélectionner' : 'Select'} -</option>`, ...list.map(l => `<option value="${l}">${l}</option>`)].join('');
            };

            fillGrouped('role-select', d.roles);
            fillGrouped('action-select', d.actions);
            fillGrouped('method-select', d.methods);
            fillSimple('tone', d.tones);
            fillSimple('format', d.formats);
        }

        function syncRole() {
            const val = document.getElementById('role-select').value;
            if (val) document.getElementById('role-custom').value = val;
            updateOutput();
        }

        function syncAction() {
            const val = document.getElementById('action-select').value;
            if (val) document.getElementById('task').value = val + " "; // Add space for continuity
            updateOutput();
        }
        
        function appendContext(text) {
            const el = document.getElementById('context');
            el.value = el.value + (el.value.length > 0 && !el.value.endsWith('\n') ? '\n' : '') + text;
            el.focus();
            updateOutput();
        }

        function resetForm() {
            document.querySelectorAll('input[type="text"], textarea').forEach(el => el.value = '');
            document.querySelectorAll('select').forEach(el => el.selectedIndex = 0);
            document.getElementById('zero-forget').checked = true;
            updateOutput();
        }

        function updateOutput() {
            const role = document.getElementById('role-custom').value;
            const task = document.getElementById('task').value;
            const context = document.getElementById('context').value;
            const method = document.getElementById('method-select').value;
            const resources = document.getElementById('resources').value;
            const tone = document.getElementById('tone').value;
            const format = document.getElementById('format').value;
            const constraints = document.getElementById('constraints').value;
            const zero = document.getElementById('zero-forget').checked;

            const hasContent = role || task || context || method || resources || tone || format || constraints;
            document.getElementById('empty-state').style.display = hasContent ? 'none' : 'flex';
            document.getElementById('markdown-content').style.display = hasContent ? 'block' : 'none';

            let prompt = "";
            const t = state.lang === 'fr' ? { c: "Tu es", a: "Ta mission est de", d: "Le contexte est", r: "Tu t'appuieras sur", e: "Exigences", tone: "Ton", fmt: "Format", cstr: "Contraintes", useMethod: "Utilise la méthode" } 
                                          : { c: "You are", a: "Your mission is to", d: "The context is", r: "You will rely on", e: "Requirements", tone: "Tone", fmt: "Format", cstr: "Constraints", useMethod: "Use the method" };

            // Construction du prompt avec les mots-clés CADREZ en gras
            if (role) prompt += `**${t.c}** : ${role}.\n\n`;
            if (task) prompt += `**${t.a}** : ${task}\n\n`;
            if (context) prompt += `**${t.d}** : ${context}\n\n`;
            
            if (method || resources) {
                prompt += `**${t.r}** : `;
                if (method) prompt += `${t.useMethod} ${method}. `;
                if (resources) prompt += `${resources}`;
                prompt += `\n\n`;
            }
            
            let reqs = [];
            if (tone && tone !== "Défaut" && tone !== "Default") reqs.push(`${t.tone} : ${tone}`);
            if (format && format !== "Texte libre" && format !== "Free text") reqs.push(`${t.fmt} : ${format}`);
            if (constraints) reqs.push(`${t.cstr} : ${constraints}`);
            
            if (reqs.length) prompt += `**${t.e}** :\n- ${reqs.join('\n- ')}\n\n`;
            
            if (zero) {
                prompt += `---\n${data[state.lang].magic_phrase}`;
            }

            document.getElementById('markdown-content').innerText = prompt;
            document.getElementById('mobile-markdown-content').innerText = prompt;
        }

        function copyContent() {
            const content = document.getElementById('markdown-content').innerText;
            if(!content) return;
            
            navigator.clipboard.writeText(content).then(() => {
                const toast = document.getElementById('toast');
                toast.classList.remove('opacity-0', 'scale-90');
                setTimeout(() => toast.classList.add('opacity-0', 'scale-90'), 2500);
            });
        }

        function showMobileTab(tab) {
            const overlay = document.getElementById('mobile-preview-overlay');
            const btnEditor = document.getElementById('nav-btn-editor');
            const btnPreview = document.getElementById('nav-btn-preview');

            if (tab === 'preview') {
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
                btnEditor.classList.remove('text-md-sys-primary');
                btnEditor.classList.add('text-gray-400');
                btnPreview.classList.add('text-md-sys-primary');
                btnPreview.classList.remove('text-gray-400');
            } else {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
                btnEditor.classList.add('text-md-sys-primary');
                btnEditor.classList.remove('text-gray-400');
                btnPreview.classList.remove('text-md-sys-primary');
                btnPreview.classList.add('text-gray-400');
            }
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
